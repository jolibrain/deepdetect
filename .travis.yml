language: cpp
compiler: gcc
sudo: required
dist: trusty

before_install:
   - sudo apt-mark hold postgresql-9.3 postgresql-9.4 postgresql-9.5 postgresql-9.6
   - sudo apt-get update && sudo apt-get upgrade -y
   - sudo apt-get install libeigen3-dev
   - sudo apt-get install libopencv-dev
   - sudo apt-get install libboost1.54-all-dev
   - sudo apt-get install libopenblas-dev 

   - cd /usr/lib/x86_64-linux-gnu
   - sudo ln -s libhdf5_serial.so.8.0.2 libhdf5.so
   - sudo ln -s libhdf5_serial_hl.so.8.0.2 libhdf5_hl.so
   - cd 

   - wget https://github.com/google/protobuf/releases/download/v2.6.1/protobuf-2.6.1.tar.gz
   - tar -xzvf protobuf-2.6.1.tar.gz
   - cd protobuf-2.6.1
   - export LD_LIBRARY_PATH=/usr/local/lib
   - ./configure
   - make
   - sudo make install
   - cd ..
   - wget https://github.com/schuhschuh/gflags/archive/master.zip
   - unzip master.zip
   - cd gflags-master
   - mkdir build && cd build
   - export CXXFLAGS="-fPIC" && cmake .. && make VERBOSE=1
   - make 
   - sudo make install
   - cd ..
   - cd ..

   - export HDF5_DIR=/usr/lib/x86_64-linux-gnu/hdf5/serial/
   - pip install h5py 
install:
   - mkdir build1
   - cd build1
   - cmake .. -DUSE_CPU_ONLY=ON -DBoost_USE_STATIC_LIBS=ON
#   - export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda/lib64
   - make
   - cd ..
   - cd ..

#before_script:
#   - cd ..
#   - cd build/caffe_dd/src/caffe_dd
#   - ./scripts/download_model_binary.py models/bvlc_googlenet/
#   - cd ..
#   - cd ..
#   - cd ..
#   - cd ..
#   - mkdir models
#   - mkdir models/imgnet
#   - cp build/caffe_dd/src/caffe_dd/models/bvlc_googlenet/bvlc_googlenet.caffemodel models/imgnet
#   - cp datasets/imagenet/corresp_ilsvrc12.txt models/imgnet/corresp.txt
#   - cd models
#   - mkdir voc0712
#   - cd voc0712
#   - wget https://deepdetect.com/models/voc0712_dd.tar.gz
#   - tar xvzf voc01712_dd.tar.gz
#   - cd ..
#   - cd ..
#   - ./build/main/dede
#script:
#   - cmake .. -DBUILD_TESTS=ON
#   - make
#   - ctest
notifications:
   email:
      on_success: always
      on_failure: always
