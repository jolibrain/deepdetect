language: cpp
compiler: gcc
sudo: required
dist: trusty

before_install:
   - sudo apt-get update
   - cd src
   - hg clone https://bitbucket.org/eigen/eigen/
   - ls
   - cd ..
   - sudo apt-get install build-essential libgoogle-glog-dev libgflags-dev libeigen3-dev libopencv-dev libcppnetlib-dev libboost-dev libboost-iostreams-dev libcurlpp-dev libcurl4-openssl-dev protobuf-compiler libopenblas-dev libhdf5-dev libprotobuf-dev libleveldb-dev libsnappy-dev liblmdb-dev libutfcpp-dev
   - sudo add-apt-repository ppa:ubuntu-toolchain-r/test
   - sudo apt-get upgrade gcc g++

install:
   - mkdir build
   - cd build
   - pwd
   - cd ..
   - cd src
   - cd eigen
   - cmake ..
   - export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda/lib64
   - export CC=gcc CXX=g++
   - make
   - cd ..
   - cd ..

install:
   - mkdir build
   - cd build
   - cmake ..
   - export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda/lib64
   - export CC=gcc CXX=g++
   - make 
   - cd ..
   - cd ..
before_script:
   - cd ..
   - cd build/caffe_dd/src/caffe_dd
   - ./scripts/download_model_binary.py models/bvlc_googlenet/
   - cd ..
   - cd ..
   - cd ..
   - cd ..
   - mkdir models
   - mkdir models/imgnet
   - cp build/caffe_dd/src/caffe_dd/models/bvlc_googlenet/bvlc_googlenet.caffemodel models/imgnet
   - cp datasets/imagenet/corresp_ilsvrc12.txt models/imgnet/corresp.txt
   - cd models
   - mkdir voc0712
   - cd voc0712
   - wget https://deepdetect.com/models/voc0712_dd.tar.gz
   - tar xvzf voc01712_dd.tar.gz
   - cd ..
   - cd ..
   - ./build/main/dede
script:
   - cmake .. -DBUILD_TESTS=ON
   - make
   - ctest
notifications:
   email:
      on_success: always
      on_failure: always
